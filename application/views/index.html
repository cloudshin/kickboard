<head>
    <!-- Bootstrap include -->
    <link
        rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
        crossorigin="anonymous"
    />

    <!-- fontawsome -->
    <link
        rel="stylesheet"
        href="https://use.fontawesome.com/releases/v5.9.0/css/all.css"
    />

    <!-- jquery 버전 유의 -->
    <!-- slim/jquery, 3.1.0 윗 버전에서 ajax가 작동하지 않는 오류 확인 -->
    <!-- Bootstrap의 CDN을 copy&paste 하되 Line 8의 버전만 3.1.0으로 수정하세요 -->
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>

<body>
    <div class="container">
        <i
            class="fal fa-alarm-clock"
            style="font-size: 100px; color: rgb(255, 0, 0)"
        ></i>
        <h1>KickBoard<br />프로토타입</h1>
        <hr />
        <div class="row justify-content-md-center">
            <div class="col-lg">
                <div id="new-alert"></div>
                <h3>새 킥보드를 추가합니다</h3>
                <input
                    type="text"
                    id="new-kickID"
                    name="kickid"
                    placeholder="새로 추가할 킥보드의 ID을 입력하세요"
                />
                <br />
                <input
                    type="text"
                    id="new-time"
                    name="time"
                    placeholder="새로 추가할 킥보드의 배치 시간을 입력하세요"
                />
                <br />
                <input
                    type="text"
                    id="new-location"
                    name="location"
                    placeholder="새로 추가할 킥보드의 위치를 입력하세요"
                />
                <br />
                <button class="btn btn-primary" id="new-btn">추가하기</button>
            </div>
        </div>

        <div class="row justify-content-md-center">
            <div class="col-lg">
                <div id="discard-alert"></div>
                <h3>킥보드를 폐기합니다</h3>
                <input
                    type="text"
                    id="dis-kickID"
                    name="kickid"
                    placeholder="폐기할 킥보드의 ID을 입력하세요"
                />
                <br />
                <button class="btn btn-primary" id="dis-btn">추가하기</button>
            </div>
        </div>

        <div class="row justify-content-md-center">
            <div class="col-lg">
                <div id="use-alert"></div>
                <h3>킥보드를 사용합니다</h3>
                <input
                    type="text"
                    id="use-kickID"
                    name="kickid"
                    placeholder="사용할 킥보드의 ID을 입력하세요"
                />
                <br />
                <input
                    type="text"
                    id="use-time"
                    name="time"
                    placeholder="킥보드의 사용 시작 시간을 입력하세요"
                />
                <br />
                <input
                    type="text"
                    id="use-location"
                    name="location"
                    placeholder="킥보드의 사용 시작 위치를 입력하세요"
                />
                <br />
                <button class="btn btn-primary" id="use-btn">추가하기</button>
            </div>
        </div>

        <div class="row justify-content-md-center">
            <div class="col-lg">
                <div id="fin-alert"></div>
                <h3>킥보드 사용을 종료합니다</h3>
                <input
                    type="text"
                    id="fin-kickID"
                    name="kickid"
                    placeholder="사용 종료할 킥보드의 ID을 입력하세요"
                />
                <br />
                <input
                    type="text"
                    id="fin-time"
                    name="time"
                    placeholder="킥보드의 사용 종료 시간을 입력하세요"
                />
                <br />
                <input
                    type="text"
                    id="fin-location"
                    name="location"
                    placeholder="킥보드의 사용 종료 위치를 입력하세요"
                />
                <br />
                <button class="btn btn-primary" id="fin-btn">추가하기</button>
            </div>
        </div>

        <div class="row justify-content-md-center">
            <div class="col-lg">
                <div id="enroll-alert"></div>
                <h3>킥보드 정보를 등록합니다</h3>
                <input
                    type="text"
                    id="enroll-kickID"
                    name="kickid"
                    placeholder="정보 등록할 킥보드의 ID을 입력하세요"
                />
                <br />
                <input
                    type="text"
                    id="enroll-time"
                    name="time"
                    placeholder="킥보드의 정보 등록 시간을 입력하세요"
                />
                <br />
                <input
                    type="text"
                    id="enroll-location"
                    name="location"
                    placeholder="킥보드의 정보 등록 위치를 입력하세요"
                />
                <br />
                <input
                    type="text"
                    id="enroll-bat"
                    name="location"
                    placeholder="킥보드의 배터리 잔량을 입력하세요"
                />
                <br />
                <button class="btn btn-primary" id="enroll-btn">추가하기</button>
            </div>
        </div>

        <div class="row justify-content-md-center">
            <div class="col-lg">
                <div id="find-alert"></div>
                <h3>빅보드의 정보를 조회합니다</h3>
                <input
                    type="text"
                    id="find-kickID"
                    name="kickid"
                    placeholder="조회할 킥보드의 ID를 입력하세요"
                />
                <br />
                <button class="btn btn-warning" id="find-btn">조회하기</button>

                <!-- 테이블 안에 row를 하나씩 붙이는 곳 -->
                <table class="table">
                    <tbody id="table"></tbody>
                </table>
            </div>
        </div>
    </div>
</body>

<script>
    $("#new-btn").click(() => {
        // new-email이라는 id값을 가지고 있는 input의 value를 가지고 옴
        const ID = $("#new-kickID").val();
        const time = $("#new-time").val();
        const location = $("#new-location").val();
        const url = "/register";

        // email이라는 파라메터에 위의 value를 넣음
        $.post(url, { kickid: ID, time: time, location: location }, (data, status) => {
            // http 상태 코드가 200(success)이라면
            if (status == "success") {
                // 성공했다는 alert창을 띄움
                $("#new-alert").append(
                    "<div id='success' class='alert alert-success'>추가를 성공했습니다!</div>"
                );
                $("#new-alert").fadeOut(4000);
            }
        });
    });

    $("#dis-btn").click(() => {
        // new-email이라는 id값을 가지고 있는 input의 value를 가지고 옴
        const ID = $("#dis-kickID").val();
        const url = "/discard";

        // email이라는 파라메터에 위의 value를 넣음
        $.post(url, { kickid: ID }, (data, status) => {
            // http 상태 코드가 200(success)이라면
            if (status == "success") {
                // 성공했다는 alert창을 띄움
                $("#discard-alert").append(
                    "<div id='success' class='alert alert-success'>폐기를 성공했습니다!</div>"
                );
                $("#discard-alert").fadeOut(4000);
            }
        });
    });

    $("#use-btn").click(() => {
        // new-email이라는 id값을 가지고 있는 input의 value를 가지고 옴
        const ID = $("#use-kickID").val();
        const time = $("#use-time").val();
        const location = $("#use-location").val();

        const url = "/use";

        // email이라는 파라메터에 위의 value를 넣음
        $.post(url, { kickid: ID, time: time, location: location }, (data, status) => {
            // http 상태 코드가 200(success)이라면
            if (status == "success") {
                // 성공했다는 alert창을 띄움
                $("#use-alert").append(
                    "<div id='success' class='alert alert-success'>킥보드 사용을 시작합니다!</div>"
                );
                $("#use-alert").fadeOut(4000);
            }
        });
    });

    $("#fin-btn").click(() => {
        // new-email이라는 id값을 가지고 있는 input의 value를 가지고 옴
        const ID = $("#fin-kickID").val();
        const time = $("#fin-time").val();
        const location = $("#fin-location").val();

        const url = "/finish";

        // email이라는 파라메터에 위의 value를 넣음
        $.post(url, { kickid: ID, time: time, location: location }, (data, status) => {
            // http 상태 코드가 200(success)이라면
            if (status == "success") {
                // 성공했다는 alert창을 띄움
                $("#fin-alert").append(
                    "<div id='success' class='alert alert-success'>킥보드 사용을 시작합니다!</div>"
                );
                $("#fin-alert").fadeOut(4000);
            }
        });
    });    

    $("#enroll-btn").click(() => {
        // new-email이라는 id값을 가지고 있는 input의 value를 가지고 옴
        const ID = $("#enroll-kickID").val();
        const time = $("#enroll-time").val();
        const location = $("#enroll-location").val();
        const bat = $("#enroll-bat").val();

        const url = "/data";

        // email이라는 파라메터에 위의 value를 넣음
        $.post(url, { kickid: ID, time: time, location: location, bat: bat }, (data, status) => {
            // http 상태 코드가 200(success)이라면
            if (status == "success") {
                // 성공했다는 alert창을 띄움
                $("#enroll-alert").append(
                    "<div id='success' class='alert alert-success'>킥보드 정보를 등록합니다!</div>"
                );
                $("#enroll-alert").fadeOut(4000);
            }
        });
    });    


    $("#find-btn").click(() => {
        const value = $("#find-kickID").val();
        const url = "/query/" + value;
        $.post(url, { kickid: value }, (data) => {
            // 조회했을 때 값이 null이 아니면 (일치하는 값이 존재한다면)
            if (status != null) {
                $("#find-alert").append(
                    "<div id='success' class='alert alert-success'>조회를 성공했습니다!</div>"
                );
                $("#find-alert").fadeOut(2000);

                // stringify는 json객체를 string으로, parse는 string을 json객체로 변환 시켜줌
                const test = JSON.stringify(data);
                const parsedData = JSON.parse(test);
                $("#table").empty();

                $("#table").append(
                    "<tr><th scope='row'>average</th><td>" +
                        parsedData.bat +
                        "</td></tr>"
                );
                // rates라는 key의 value로 Json array가 있으므로 반복문을 통해 한 줄씩 테이블에 넣어줌
                for (var i = 0; i < parsedData.history.length; i++) {
                    $("#table").append(
                        "<tr><th scope='row'>userid</th><td>" +
                            parsedData.history[i].userid +
                            "</td></tr>"
                    );
                    $("#table").append(
                        "<tr><th scope='row'>starttime</th><td>" +
                            parsedData.history[i].starttime +
                            "</td></tr>"
                    );
                    $("#table").append(
                        "<tr><th scope='row'>endtime</th><td>" +
                            parsedData.history[i].finishtime +
                            "</td></tr>"
                    );
                    $("#table").append(
                        "<tr><th scope='row'>startlocation</th><td>" +
                            parsedData.history[i].startlocation +
                            "</td></tr>"
                    );
                    $("#table").append(
                        "<tr><th scope='row'>endlocation</th><td>" +
                            parsedData.history[i].Finishlocation +
                            "</td></tr>"
                    );

                }
            }
        });
    });
</script>

<!-- styling -->
<style>
    .container {
        width: 100%;
        height: 500px;
        margin: 50px 50px;
        padding: 20px 20px;
        text-align: center;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
    }

    button {
        margin: 20px 10px;
    }

    input {
        width: 300px;
        padding: 10px 8px;
    }

    .col-6 {
        padding: 20px 10px;
    }
</style>
